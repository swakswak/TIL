# 도메인 모델과 영속 모델 (DDD Entity, ORM Entity)

Aggregate Root 라는 키워드를 검색하면 JPA(ORM)의 Entity에서 비즈니스를 처리하는 코드를 많이 접할 수 있습니다.   
도메인 주도 설계를 하고자 한다면 ORM Entity에서 비즈니스 처리를 지양하고 도메인 모델(DDD Entity)과 영속 모델(ORM Entity)을 분리해야 합니다.   

이유는 다음과 같습니다.  

* 비즈니스는 도메인 모델이 속한 계층에서 처리되어야 합니다.


* 도메인과 관련된 문제는 도메인 모델에서 풀어내야 합니다.
    * DDD에서는 저장 방법과 도메인 비즈니스를 분리해야 합니다. 이를 통해 도메인 모델에서 순수하게 도메인 비즈니스만 고민할 수 있습니다.


* 도메인 모델은 밸류 오브젝트를 사용합니다.
    * [Aggregate](https://martinfowler.com/bliki/DDD_Aggregate.html)를 적용하기 위해 VO를 사용합니다. 이는 ORM의 Entity에는 적절하지 않습니다.   
    * ORM의 Entity의 경우 key, value 형태로 구성해야 하며, VO의 형태를 가질 경우 값을 저장할 때 해당 컬럼 타입에 맞게 변환하는 로직을 짜야 합니다.
    * 만약 ORM의 Entity에서 비즈니스를 처리하는 중에 테이블 스키마가 변경 또는 저장소가 변경될 경우 큰 영향을 받습니다.
    * 도메인 모델은 데이터를 영속하는 부분으로부터 영향을 받아서는 안됩니다.  
   
그렇다면 도메인 모델과 영속 모델의 이름을 어떻게 짓는게 좋을까요?   
개인적으로는 정하기 나름이라고 생각합니다. 저와 같은 경우에는 다음과 같이 합니다. 

Employee를 예로 들겠습니다.   

| Controller (DTO)                    | DomainModel | PersistanceModel |
|-------------------------------------|-------------|------------------|
| `EmployeeDto` 또는 `EmployeeResource` | `Employee`   | `EmployeeEntity`  |

도메인 비즈니스를 순수하게 해결하기 위해 Controller, DomainModel, PersistenceModel 분리를 고민하며 개발보아야 할 것 같습니다.

---
#### 참고
* [Just Stop It! The Domain Model Is Not The Persistence Model](https://blog.sapiensworks.com/post/2012/04/07/Just-Stop-It!-The-Domain-Model-Is-Not-The-Persistence-Model.aspx)   
* [도메인 주도 설계 첫걸음](https://books.google.co.kr/books?id=rEMtzwEACAAJ&dq=%EB%8F%84%EB%A9%94%EC%9D%B8+%EC%A3%BC%EB%8F%84+%EC%84%A4%EA%B3%84+%EC%B2%AB%EA%B1%B8%EC%9D%8C&hl=ko&sa=X&redir_esc=y)
