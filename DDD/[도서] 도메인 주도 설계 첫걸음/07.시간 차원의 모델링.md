# 07. 시간 차원의 모델링

## 이벤트 소싱

* 이벤트 소싱 도메인 모델
    * 이벤트 소싱 패턴을 사용하여 애그리게이트 상태를 관리
       

* 도메인 모델은 현재의 상태를 가지지만 현재 상태까지 도달한 이력에 대한 이야기는 누락
    * 고객의 정보를 조회 - 고객의 상담 이력 누락
    * 게시판의 글 조회 - 글의 수정 내역 누락
    * 회원 정보 조회 - 회원 정보 수정 이력 누락

데이터 저장 방식 측면에서 이야기해보자.  
텔레마케팅 시스템에서 잠재 고객 또는 리드(제품에 관심이 있는 고객)을 관리하는 테이블이다.

| lead_id | first_name | last_name | status    | phone_number | followup_on | created_on              | updated_on              |
|---------|------------|-----------|-----------|--------------|-------------|-------------------------|-------------------------|
| 12      | Casey      | Davis     | CONVERTED | 555-8101     |             | 2020-05-20T00:33:13.88Z | 2020-05-20T09:52:55.95Z |

* status의 `CONVERTED`는 잠재 고객에서 실제 고객으로 전환된 상태임을 나타냄      
       

* 고객으로 전환되기 까지 거쳐온 status의 이력이 있지만 이 테이블로는 이력을 확인할 수 없음
  * CONVERTED 되기 전까지 몇 번의 전화를 걸었을까?
  * 구매가 바로 이루어졌을까?
  * 긴 판매 여정이 있었을까?      
      

* 이력과 같이 누락된 정보를 채우는 방법이 이벤트 소싱을 이용하는 방법
    * 데이터 모델에 시간 차원을 도입
    * 애그리게이트의 수명주기의 모든 변경사항을 문서화 하는 이벤트

## 원천 데이터
* 이벤트 소싱 패턴이 작동하려면?
  * 객체 상태에 대한 모든 변경사항이 이벤트로 표현/저장되어야 함
     
* 이벤트를 저장하는 데 사용되는 데이터베이스를 이벤트 스토어(event store)라고 한다.
    * 이벤트 스토어는 추가만 가능
    * 수정, 삭제 불가
    * ```csharp
        interface EventStore 
        {
          IEnumerable<Event> Fetch(Guid instanceId);
          void Append(Guid instanceId, Event[] newEvents, int expectedVersion);
        }
      ```
